<?php
/***********************************************
-=Ms Site=-

Автор: Миропольский Михаил <ms@ensk.ru>
Описание: Класс страницы
***********************************************/

class Page
{
	var $NAME, $TITLE, $URL;
	var $CONFIG = array();
	var $PAGER = array();
	
	function Page($name = 'index', $title = '')
	{
		global $item;
		
		$this->NAME = $name;
		$this->TITLE = $title;
		$this->URL = 'http://' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];		
		
		//set config
		if ($name == 'item' || $name == 'comment')
		{
			foreach( $item->FIELDS as $field)
			{
				if ( isset($field['type']) && $field['type'] == 'image' ) $this->CONFIG['javascript']['lightbox'] = 1;
			}
		}
		if ($name == 'add' || $name == 'addcat' || $name == 'addcomment')
		{
			$this->CONFIG['javascript']['validate'] = 'item';
			foreach( $item->FIELDS as $field)
			{
				if ( isset($field['tip']) && $field['tip'] == 1 ) $this->CONFIG['javascript']['jtip'] = 1;
				if ( isset($field['type']) && $field['type'] == 'date' ) $this->CONFIG['javascript']['datepicker'] = 1;
			}
		}
		if ($name == 'edit' || $name == 'editcat' || $name == 'editcomment')
		{
			$this->CONFIG['javascript']['validate'] = 'item';
			foreach( $item->FIELDS as $field)
			{
				if ( isset($field['tip']) && $field['tip'] == 1 ) $this->CONFIG['javascript']['jtip'] = 1;
				if ( isset($field['type']) && $field['type'] == 'image' ) $this->CONFIG['javascript']['lightbox'] = 1;
				if ( isset($field['type']) && $field['type'] == 'date' ) $this->CONFIG['javascript']['datepicker'] = 1;
			}
		}
	}
	
	function PagePagerInit($total, $per_page)
	{
		$this->PAGER['current'] = ( isset($_GET['page']) && preg_match('/^\d+$/',$_GET['page']) ) ? $_GET['page'] : 1;
		$this->PAGER['total'] = ceil($total / $per_page);
		$this->PAGER['start'] = $this->PAGER['current'] * $per_page - $per_page + 1;
		$this->PAGER['end'] = $this->PAGER['current'] * $per_page;
	}
	
	function PagePagerShow()
	{
		if ($this->PAGER['total'] > 1)
		{
			$request = $_GET;			 
			
			echo '<ul class="pager">';
			for ($i = 1; $i <= $this->PAGER['total']; $i++ ) 
			{
				if ($i == $this->PAGER['current'])
					echo '<li>' . $i . '</li> ';
				else
				{		
					$request['page'] = $i;	
					$url = 'http://' . $_SERVER['HTTP_HOST'] . $_SERVER['SCRIPT_NAME'] . '?' . http_build_query($request);
					echo '<li><a href="' . $url . '">' . $i . '</a></li> ';
				}
			}
			echo '</ul>';
		}
	}
}